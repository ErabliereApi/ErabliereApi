<h3>Votre profile - {{user?.name}}</h3>

<p>Bienvenue sur votre page de profil. Ici, vous pouvez voir et modifier vos informations personnelles.</p>

<div class="row">
    <div class="card col-md-4">
        <h3>Connexion active</h3>
        <span class="text-danger">{{errorToken}}</span>
        <p><strong>ID:</strong> {{ user?.id }} <copy-id-button [text]="user?.id"
                tile="Copier l'id de mon utilisateur"></copy-id-button></p>
        <p><strong>Nom:</strong> {{ user?.name }}</p>
        <p><strong>Email:</strong> {{ user?.email }}</p>
        <p><strong>R√¥les:</strong> {{ user?.roles?.join(', ') }}</p>
    </div>
    @if (customer != null) {
    <div class="card col-md-4">
        <h3>Informations du compte</h3>
        <span class="text-danger">{{errorCustomer}}</span>
        <p><strong>ID:</strong> {{ customer.id }} <copy-id-button [text]="customer.id"
                title="Copier l'id de mon compte"></copy-id-button></p>
        <p><strong>Nom:</strong> {{ customer.name }}</p>
        <p><strong>Unique Name:</strong> {{ customer.uniqueName }}</p>
        <p><strong>Email:</strong> {{ customer.email }}</p>
        <p><strong>Email secondaire:</strong> {{ customer.secondaryEmail}}</p>
        <p><strong>Type de compte:</strong> {{ customer.accountType }}</p>
        <p><strong>Cr√©√© le:</strong> {{ customer.creationTime }}</p>
        <p><strong>Derni√®re connexion:</strong> {{ customer.lastAccessTime }}</p>
    </div>
    <div class="card col-md-4">
        <h3>Cl√©s API</h3>
        <div class="btn-group mb-3">
            <ebutton type="success" (clicked)="buyApiKey()" [inProgress]="buyApiKeyClicked">Obtenir une cl√© d'api
            </ebutton>
            <ebutton class="ms-2" type="info" (clicked)="loadUserProfile()" [inProgress]="loadUserProfileClicked"
                title="Rafra√Æchir">‚ü≥</ebutton>
        </div>
        <span class="text-danger">{{errorApiKey}}</span>
        <div>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Date de cr√©ation</th>
                        <th>Derni√®re utilisation</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (customer.apiKeys && customer.apiKeys.length > 0) {
                    @for (apiKey of customer.apiKeys; track apiKey.id) {
                    <tr>
                        <td>{{ apiKey.name }}</td>
                        <td>{{ apiKey.creationTime | date: 'yyyy-MM-dd' }}</td>
                        <td>{{ apiKey.lastUsage | date: 'yyyy-MM-dd' }}</td>
                        <td>
                            <button class="btn btn-secondary btn-sm me-2" title="Modifier le nom"
                                (click)="editApiKeyName(apiKey)">‚úèÔ∏è</button>
                            <button class="btn btn-danger btn-sm" title="Supprimer"
                                (click)="deleteApiKey(apiKey.id)">üóë</button>
                        </td>
                    </tr>
                    }
                    } @else {
                    <tr>
                        <td colspan="4">Aucune cl√© API disponible.</td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-md-4 card">
        <h3>Abonnement</h3>
        <p>L'utilisateur ne poss√®de pas d'abonnement</p>
    </div>
    <div class="col-md-4 card">
        <h3>ErabliereAI</h3>
        @if (user?.roles?.includes('ErabliereAIUser')) {
        <p>ErabliereAI est activ√© pour cet utilisateur.</p>
        } @else {
        <p>ErabliereAI n'est pas activ√© pour cet utilisateur.</p>
        }
    </div>
    <div class="col-md-4 card">
        <h3>Co√ªt</h3>
        <p>Les co√ªts ne sont pas disponibles actuellement.</p>
    </div>
    }
</div>

@if (editApiKeyNameActive) {
<emodal [title]="editApiKeyNameModalTitle" [displayFooter]="false" (closed)="closeEditApiKeyNameModal()">
    <form [formGroup]="editApiKeyNameForm" [class]="'p-3'" novalidate>
        <div class="mb-3">
            <einput [id]="'name'" [name]="'name'" [placeholder]="'Nom de la cl√© API'" [formGroup]="editApiKeyNameForm"
                [maxlength]="100" [errorObj]="editApiKeyErrorObj"></einput>
        </div>
        <div class="text-end">
            <ebutton type="secondary" class="me-2" (clicked)="closeEditApiKeyNameModal()">Annuler</ebutton>
            <ebutton type="primary" (clicked)="saveEditedApiKeyName()" [inProgress]="saveEditApiKeyNameInProgress">
                Enregistrer</ebutton>
        </div>
    </form>
</emodal>
}